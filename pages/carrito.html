<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="../assets/favicons/favicon.ico" type="image/x-icon" />

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="/css/carritoEstilos.css">
  <title>Pixelpro - Carrito de Compras</title>
</head>

<body>
  <!-- Header cargado automáticamente -->
  <header id="header"></header>

  <!-- MAIN -->
  <main class="container my-5">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-4">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/index.html" class="text-decoration-none">Inicio</a></li>
        <li class="breadcrumb-item"><a href="/pages/productos.html" class="text-decoration-none">Productos</a></li>
        <li class="breadcrumb-item active" aria-current="page">Carrito</li>
      </ol>
    </nav>

    <!-- Título Principal -->
    <div class="row mb-4">
      <div class="col-12">
        <h1 class="h2 fw-bold d-flex align-items-center">
          <i class="bi bi-cart3 me-3 text-primary fs-1"></i>
          Carrito de Compras
        </h1>
        <p class="text-muted" id="carritoSubtitulo">3 productos en tu carrito</p>
      </div>
    </div>

    <!-- Contenido del Carrito -->
    <div class="row" id="carritoContenido">
      <!-- Lista de productos -->
      <div class="col-lg-8 col-md-7 mb-4">
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
              <i class="bi bi-bag me-2"></i>Productos en tu carrito
            </h5>
            <button class="btn btn-outline-danger btn-sm" onclick="limpiarCarrito()">
              <i class="bi bi-trash me-1"></i>Vaciar carrito
            </button>
          </div>
          <div class="card-body p-0">
            <div id="listaProductos">
              <!-- Producto 1 -->
              <div class="producto-item p-3 border-bottom" data-producto-id="1">
                <div class="row align-items-center">
                  <div class="col-md-2 col-3 mb-2 mb-md-0">
                    <img src="/assets/imgs/HyperX_Cloud_Core_USB.webp" alt="HyperX Cloud Core USB"
                      class="img-fluid rounded product-image">
                  </div>
                  <div class="col-md-4 col-9 mb-2 mb-md-0">
                    <h6 class="mb-1 product-name">HyperX Cloud Core USB</h6>
                    <p class="text-muted mb-1 small">Auriculares Gaming</p>
                    <span class="badge bg-success small">En stock</span>
                  </div>
                  <div class="col-md-2 col-4 mb-2 mb-md-0">
                    <label class="form-label small text-muted">Precio</label>
                    <p class="mb-0 fw-bold text-primary product-price">S/ 199.90</p>
                  </div>
                  <div class="col-md-2 col-4 mb-2 mb-md-0">
                    <label class="form-label small text-muted">Cantidad</label>
                    <div class="input-group input-group-sm">
                      <button class="btn btn-outline-secondary" type="button" onclick="cambiarCantidad(1, -1)">
                        <i class="bi bi-dash"></i>
                      </button>
                      <input type="number" class="form-control text-center cantidad-input" value="2" min="1" max="99"
                        onchange="actualizarCantidad(1, this.value)">
                      <button class="btn btn-outline-secondary" type="button" onclick="cambiarCantidad(1, 1)">
                        <i class="bi bi-plus"></i>
                      </button>
                    </div>
                  </div>
                  <div class="col-md-1 col-2 mb-2 mb-md-0">
                    <label class="form-label small text-muted d-none d-md-block">Subtotal</label>
                    <p class="mb-0 fw-bold product-subtotal">S/ 399.80</p>
                  </div>
                  <div class="col-md-1 col-2 text-center">
                    <button class="btn btn-outline-danger btn-sm" onclick="eliminarProducto(1)"
                      title="Eliminar producto">
                      <i class="bi bi-x-lg"></i>
                    </button>
                  </div>
                </div>
              </div>

              <!-- Producto 2 -->
              <div class="producto-item p-3 border-bottom" data-producto-id="2">
                <div class="row align-items-center">
                  <div class="col-md-2 col-3 mb-2 mb-md-0">
                    <img src="/assets/imgs/Logitech_G203_USB.webp" alt="Logitech G203 USB"
                      class="img-fluid rounded product-image">
                  </div>
                  <div class="col-md-4 col-9 mb-2 mb-md-0">
                    <h6 class="mb-1 product-name">Logitech G203 USB</h6>
                    <p class="text-muted mb-1 small">Mouse Gaming</p>
                    <span class="badge bg-warning text-dark small">Últimas unidades</span>
                  </div>
                  <div class="col-md-2 col-4 mb-2 mb-md-0">
                    <label class="form-label small text-muted">Precio</label>
                    <p class="mb-0 fw-bold text-primary product-price">S/ 89.90</p>
                  </div>
                  <div class="col-md-2 col-4 mb-2 mb-md-0">
                    <label class="form-label small text-muted">Cantidad</label>
                    <div class="input-group input-group-sm">
                      <button class="btn btn-outline-secondary" type="button" onclick="cambiarCantidad(2, -1)">
                        <i class="bi bi-dash"></i>
                      </button>
                      <input type="number" class="form-control text-center cantidad-input" value="1" min="1" max="99"
                        onchange="actualizarCantidad(2, this.value)">
                      <button class="btn btn-outline-secondary" type="button" onclick="cambiarCantidad(2, 1)">
                        <i class="bi bi-plus"></i>
                      </button>
                    </div>
                  </div>
                  <div class="col-md-1 col-2 mb-2 mb-md-0">
                    <label class="form-label small text-muted d-none d-md-block">Subtotal</label>
                    <p class="mb-0 fw-bold product-subtotal">S/ 89.90</p>
                  </div>
                  <div class="col-md-1 col-2 text-center">
                    <button class="btn btn-outline-danger btn-sm" onclick="eliminarProducto(2)"
                      title="Eliminar producto">
                      <i class="bi bi-x-lg"></i>
                    </button>
                  </div>
                </div>
              </div>

              <!-- Producto 3 -->
              <div class="producto-item p-3" data-producto-id="3">
                <div class="row align-items-center">
                  <div class="col-md-2 col-3 mb-2 mb-md-0">
                    <img src="/assets/imgs/Monitor_ASUS_TUF_GAMING_24.webp" alt="Monitor ASUS TUF Gaming 24"
                      class="img-fluid rounded product-image">
                  </div>
                  <div class="col-md-4 col-9 mb-2 mb-md-0">
                    <h6 class="mb-1 product-name">Monitor ASUS TUF Gaming 24"</h6>
                    <p class="text-muted mb-1 small">Monitor Gaming Full HD</p>
                    <span class="badge bg-success small">En stock</span>
                  </div>
                  <div class="col-md-2 col-4 mb-2 mb-md-0">
                    <label class="form-label small text-muted">Precio</label>
                    <p class="mb-0 fw-bold text-primary product-price">S/ 699.00</p>
                  </div>
                  <div class="col-md-2 col-4 mb-2 mb-md-0">
                    <label class="form-label small text-muted">Cantidad</label>
                    <div class="input-group input-group-sm">
                      <button class="btn btn-outline-secondary" type="button" onclick="cambiarCantidad(3, -1)">
                        <i class="bi bi-dash"></i>
                      </button>
                      <input type="number" class="form-control text-center cantidad-input" value="1" min="1" max="99"
                        onchange="actualizarCantidad(3, this.value)">
                      <button class="btn btn-outline-secondary" type="button" onclick="cambiarCantidad(3, 1)">
                        <i class="bi bi-plus"></i>
                      </button>
                    </div>
                  </div>
                  <div class="col-md-1 col-2 mb-2 mb-md-0">
                    <label class="form-label small text-muted d-none d-md-block">Subtotal</label>
                    <p class="mb-0 fw-bold product-subtotal">S/ 699.00</p>
                  </div>
                  <div class="col-md-1 col-2 text-center">
                    <button class="btn btn-outline-danger btn-sm" onclick="eliminarProducto(3)"
                      title="Eliminar producto">
                      <i class="bi bi-x-lg"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Productos Recomendados -->
        <div class="card mt-4">
          <div class="card-header">
            <h6 class="mb-0">
              <i class="bi bi-lightning me-2"></i>También te podría interesar
            </h6>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-4 col-6 mb-3">
                <div class="card h-100 recommendation-card">
                  <img src="/assets/imgs/JBL_Quantum_350_USB.webp" class="card-img-top" alt="JBL Quantum 350">
                  <div class="card-body p-2">
                    <h6 class="card-title small">JBL Quantum 350</h6>
                    <p class="card-text small text-muted">S/ 149.90</p>
                    <button class="btn btn-outline-primary btn-sm w-100" onclick="agregarRecomendado('jbl-quantum')">
                      <i class="bi bi-plus me-1"></i>Agregar
                    </button>
                  </div>
                </div>
              </div>
              <div class="col-md-4 col-6 mb-3">
                <div class="card h-100 recommendation-card">
                  <img src="/assets/imgs/Logitech_G502_X_USB.webp" class="card-img-top" alt="Logitech G502 X">
                  <div class="card-body p-2">
                    <h6 class="card-title small">Logitech G502 X</h6>
                    <p class="card-text small text-muted">S/ 189.90</p>
                    <button class="btn btn-outline-primary btn-sm w-100" onclick="agregarRecomendado('logitech-g502')">
                      <i class="bi bi-plus me-1"></i>Agregar
                    </button>
                  </div>
                </div>
              </div>
              <div class="col-md-4 col-6 mb-3 d-none d-md-block">
                <div class="card h-100 recommendation-card">
                  <img src="/assets/imgs/HyperX_Pulsefire_FPS_Pro_USB.webp" class="card-img-top" alt="HyperX Pulsefire">
                  <div class="card-body p-2">
                    <h6 class="card-title small">HyperX Pulsefire Pro</h6>
                    <p class="card-text small text-muted">S/ 119.90</p>
                    <button class="btn btn-outline-primary btn-sm w-100"
                      onclick="agregarRecomendado('hyperx-pulsefire')">
                      <i class="bi bi-plus me-1"></i>Agregar
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Resumen del pedido -->
      <div class="col-lg-4 col-md-5">
        <div class="card sticky-top" style="top: 20px;">
          <div class="card-header">
            <h5 class="mb-0">
              <i class="bi bi-receipt me-2"></i>Resumen del pedido
            </h5>
          </div>
          <div class="card-body">
            <div class="row mb-3">
              <div class="col-6">Subtotal:</div>
              <div class="col-6 text-end" id="subtotalCarrito">S/ 1,188.70</div>
            </div>
            <div class="row mb-3">
              <div class="col-6">Envío:</div>
              <div class="col-6 text-end">
                <span class="text-success fw-bold">GRATIS</span>
                <small class="text-muted d-block">Compra mayor a S/ 100</small>
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-6">
                <small>Descuento:</small>
              </div>
              <div class="col-6 text-end">
                <span class="text-success">-S/ 50.00</span>
                <small class="text-muted d-block">Cupón BIENVENIDO</small>
              </div>
            </div>
            <hr>
            <div class="row mb-4">
              <div class="col-6">
                <strong>Total:</strong>
              </div>
              <div class="col-6 text-end">
                <strong class="fs-5 text-primary" id="totalCarrito">S/ 1,138.70</strong>
              </div>
            </div>

            <!-- Cupón de descuento -->
            <div class="mb-3">
              <label class="form-label small">¿Tienes un cupón?</label>
              <div class="input-group input-group-sm">
                <input type="text" class="form-control" placeholder="Código de cupón" id="inputCupon">
                <button class="btn btn-outline-primary" type="button" onclick="aplicarCupon()">
                  <i class="bi bi-tag me-1"></i>Aplicar
                </button>
              </div>
            </div>

            <!-- Botones de acción -->
            <div class="d-grid gap-2">
              <button class="btn btn-primary btn-lg" onclick="procederPago()">
                <i class="bi bi-credit-card me-2"></i>Proceder al pago
              </button>
              <button class="btn btn-outline-secondary" onclick="continuarComprando()">
                <i class="bi bi-arrow-left me-2"></i>Seguir comprando
              </button>
            </div>

            <!-- Información adicional -->
            <div class="mt-4">
              <h6 class="small text-muted mb-2">Información de envío:</h6>
              <div class="d-flex align-items-center mb-2">
                <i class="bi bi-truck text-success me-2"></i>
                <small>Envío gratis en compras mayores a S/ 100</small>
              </div>
              <div class="d-flex align-items-center mb-2">
                <i class="bi bi-clock text-primary me-2"></i>
                <small>Entrega en 2-3 días hábiles</small>
              </div>
              <div class="d-flex align-items-center">
                <i class="bi bi-shield-check text-success me-2"></i>
                <small>Compra 100% segura</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Estado carrito vacío -->
    <div class="row d-none" id="carritoVacio">
      <div class="col-12">
        <div class="text-center py-5">
          <i class="bi bi-cart-x display-1 text-muted mb-4"></i>
          <h3 class="mb-3">Tu carrito está vacío</h3>
          <p class="text-muted mb-4">Parece que no has agregado ningún producto a tu carrito todavía.</p>
          <a href="/pages/productos.html" class="btn btn-primary btn-lg">
            <i class="bi bi-shop me-2"></i>Explorar productos
          </a>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer cargado automáticamente -->
  <footer id="footer" class="bg-light pt-5"></footer>

  <!-- Scripts -->
  <script type="module" src="/js/include.js"></script>
  <script type="module" src="/js/auth/auth-header.js"></script>
  <script>
    // Variables globales
    let carritoData = {
      productos: [
        { id: 1, nombre: 'HyperX Cloud Core USB', precio: 199.90, cantidad: 2, imagen: '/assets/imgs/HyperX_Cloud_Core_USB.webp' },
        { id: 2, nombre: 'Logitech G203 USB', precio: 89.90, cantidad: 1, imagen: '/assets/imgs/Logitech_G203_USB.webp' },
        { id: 3, nombre: 'Monitor ASUS TUF Gaming 24"', precio: 699.00, cantidad: 1, imagen: '/assets/imgs/Monitor_ASUS_TUF_GAMING_24.webp' }
      ],
      descuento: 50.00,
      envio: 0.00
    };

    document.addEventListener('DOMContentLoaded', function () {
      actualizarResumen();
      verificarCarritoVacio();
    });

    function cambiarCantidad(productId, cambio) {
      const producto = carritoData.productos.find(p => p.id === productId);
      if (producto) {
        const nuevaCantidad = Math.max(1, Math.min(99, producto.cantidad + cambio));
        producto.cantidad = nuevaCantidad;

        // Actualizar el input
        const input = document.querySelector(`[data-producto-id="${productId}"] .cantidad-input`);
        input.value = nuevaCantidad;

        actualizarSubtotalProducto(productId);
        actualizarResumen();
      }
    }

    function actualizarCantidad(productId, nuevaCantidad) {
      const cantidad = Math.max(1, Math.min(99, parseInt(nuevaCantidad) || 1));
      const producto = carritoData.productos.find(p => p.id === productId);

      if (producto) {
        producto.cantidad = cantidad;

        // Actualizar el input en caso de que el valor sea inválido
        const input = document.querySelector(`[data-producto-id="${productId}"] .cantidad-input`);
        input.value = cantidad;

        actualizarSubtotalProducto(productId);
        actualizarResumen();
      }
    }

    function actualizarSubtotalProducto(productId) {
      const producto = carritoData.productos.find(p => p.id === productId);
      if (producto) {
        const subtotal = producto.precio * producto.cantidad;
        const subtotalElement = document.querySelector(`[data-producto-id="${productId}"] .product-subtotal`);
        subtotalElement.textContent = `S/ ${subtotal.toFixed(2)}`;
      }
    }

    function eliminarProducto(productId) {
      if (confirm('¿Estás seguro de que quieres eliminar este producto del carrito?')) {
        // Eliminar del array
        carritoData.productos = carritoData.productos.filter(p => p.id !== productId);

        // Eliminar del DOM
        const productoElement = document.querySelector(`[data-producto-id="${productId}"]`);
        productoElement.remove();

        actualizarResumen();
        verificarCarritoVacio();

        // Mostrar notificación
        mostrarNotificacion('Producto eliminado del carrito', 'success');
      }
    }

    function limpiarCarrito() {
      if (confirm('¿Estás seguro de que quieres vaciar todo el carrito?')) {
        carritoData.productos = [];
        document.getElementById('listaProductos').innerHTML = '';
        verificarCarritoVacio();
        mostrarNotificacion('Carrito vaciado', 'info');
      }
    }

    function actualizarResumen() {
      const subtotal = carritoData.productos.reduce((sum, producto) => sum + (producto.precio * producto.cantidad), 0);
      const total = subtotal - carritoData.descuento + carritoData.envio;

      document.getElementById('subtotalCarrito').textContent = `S/ ${subtotal.toFixed(2)}`;
      document.getElementById('totalCarrito').textContent = `S/ ${total.toFixed(2)}`;

      const totalProductos = carritoData.productos.reduce((sum, producto) => sum + producto.cantidad, 0);
      document.getElementById('carritoSubtitulo').textContent = `${totalProductos} producto${totalProductos !== 1 ? 's' : ''} en tu carrito`;
    }

    function verificarCarritoVacio() {
      const carritoContenido = document.getElementById('carritoContenido');
      const carritoVacio = document.getElementById('carritoVacio');

      if (carritoData.productos.length === 0) {
        carritoContenido.classList.add('d-none');
        carritoVacio.classList.remove('d-none');
      } else {
        carritoContenido.classList.remove('d-none');
        carritoVacio.classList.add('d-none');
      }
    }

    function aplicarCupon() {
      const codigoCupon = document.getElementById('inputCupon').value.trim().toUpperCase();

      if (codigoCupon === 'BIENVENIDO') {
        mostrarNotificacion('Cupón aplicado correctamente', 'success');
      } else if (codigoCupon === 'DESCUENTO10') {
        carritoData.descuento = carritoData.productos.reduce((sum, p) => sum + (p.precio * p.cantidad), 0) * 0.1;
        actualizarResumen();
        mostrarNotificacion('Cupón de 10% aplicado', 'success');
      } else if (codigoCupon === '') {
        mostrarNotificacion('Por favor ingresa un código de cupón', 'warning');
      } else {
        mostrarNotificacion('Código de cupón inválido', 'error');
      }

      document.getElementById('inputCupon').value = '';
    }

    function procederPago() {
      if (carritoData.productos.length === 0) {
        mostrarNotificacion('Tu carrito está vacío', 'warning');
        return;
      }

      // Aquí se redirigiría al checkout
      mostrarNotificacion('Redirigiendo al checkout...', 'info');
      setTimeout(() => {
        // window.location.href = '/pages/checkout.html';
        alert('Función de checkout en desarrollo');
      }, 1500);
    }

    function continuarComprando() {
      window.location.href = '/pages/productos.html';
    }

    function agregarRecomendado(productId) {
      mostrarNotificacion('Producto agregado al carrito', 'success');
      // Aquí se agregaría el producto recomendado al carrito
    }

    function mostrarNotificacion(mensaje, tipo) {
      // Crear elemento de notificación
      const notificacion = document.createElement('div');
      notificacion.className = `alert alert-${tipo === 'error' ? 'danger' : tipo} alert-dismissible fade show position-fixed`;
      notificacion.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
      notificacion.innerHTML = `
        ${mensaje}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      `;

      document.body.appendChild(notificacion);

      // Auto-ocultar después de 3 segundos
      setTimeout(() => {
        if (notificacion.parentNode) {
          notificacion.remove();
        }
      }, 3000);
    }

    // Agregar funcionalidad de Enter para el cupón
    document.getElementById('inputCupon').addEventListener('keypress', function (e) {
      if (e.key === 'Enter') {
        aplicarCupon();
      }
    });
  </script>
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>